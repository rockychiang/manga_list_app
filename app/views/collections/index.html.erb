<div class="row">
  <div class="col-sm-12">

    <h2><%= @user.name %>'s Manga</h2>

    <table class="table">
      <tr class="info">

        <th><strong>Title</strong></th>
        <th><strong>Rating</strong></th>
        <th><strong>Status</strong></th>

        <% if @user == current_user %>
          <th></th>
        <% end %>

      </tr>

      <% @user.collections.each do |collection| %>
        <tr>

          <td><%= link_to collection.manga.title, manga_path(collection.manga) %></td>
          <td><%= average_rating(collection.manga) %></td>
          <td><%= render '/collections/status', user: @user, collection: collection %></td>

          <% if @user == current_user %>
            <td><%= render '/collections/delete_button', user: @user, collection: collection %></td>
          <% end %>

        </tr>
      <% end %>
    </table>

  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <h2><%= @user.name %>'s Reviews</h2>
    <div id="reviews" class="row">
      <div class="col-sm-12">
        <a href="#reviews" id="js-show-reviews" class="btn btn-default" data-id="<%= @user.id %>">Show Reviews</a>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
  $(function () {
    $('#js-show-reviews').on('click', function(e) {
      e.preventDefault();
      $('#reviews').html("");
      $.get('/users/<%= @user.id %>/collections.json', function(collections) {
        collections.forEach(function(collection) {
          if (collection.review != null) {
            let html = `<div class='col-sm-4'>`;
            html += `<p>${collection.manga.title}</p>`;
            html += `<p>${collection.rating}</p>`;
            html += `<p>${collection.review}</p>`;
            html += `</div>`;
            $('#reviews').append(html);
          };
        });
      });
    });
  });
</script>
